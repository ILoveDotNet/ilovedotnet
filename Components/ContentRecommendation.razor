@using Humanizer
@inject AdSpaceService adSpaceService
@inject TableOfContents tableOfContents

<aside class="[ flex flex-col md:basis-1/4 ] [ space-y-2 ]">
    <GoogleAdSense Type="GoogleAdSenseAdType.InFeed" Format="GoogleAdSenseAdFormat.Fluid" LayoutKey="-7m+de+1z+n+3" Slot="2741354693"></GoogleAdSense>
    @foreach (var (content, index) in tableOfContents.Contents
                                                     .Where(content => !content.Title.Equals(Title, StringComparison.OrdinalIgnoreCase))
                                                     .OrderByDescending(content => content.CreatedOn)
                                                     .SelectWithIndex())
    {
        @if (adSpaceService.CanDisplayAd(index + 1))
        {
            <GoogleAdSense Type="GoogleAdSenseAdType.InFeed" Format="GoogleAdSenseAdFormat.Fluid" LayoutKey="-7m+de+1z+n+3" Slot="2741354693"></GoogleAdSense>
        }

        @if (SmallDevice)
        {
            <section class="[ flex flex-col justify-between ] [ h-full ]">
                <header>
                    <NavLink href="@content.ContentUrl">
                        <figure>
                            <img src="@content.PosterUrl" class="[ w-full ]" alt="@content.Title" loading="lazy" />
                        </figure>
                    </NavLink>
                </header>
                <div class="[ grow flex ]">
                    <aside class="[ basis-1/6 flex items-center ]">
                        <NavLink href="@($"channels/{content.Type.ToLower()}")">
                            <figure>
                                <img src="@content.IconUrl" alt="@content.Type" loading="lazy" height="48" width="48" class="[ rounded-full ]" />
                            </figure>
                        </NavLink>
                    </aside>
                    <article class="[ grow flex flex-col justify-between basis-5/6 ] [ dark:text-white ] [ mt-2 ]">
                        <NavLink href="@content.ContentUrl">
                            <h2 class="[ font-medium break-words hover:underline ]">@content.Title</h2>
                        </NavLink>
                        <section class="[ flex justify-between ]">
                            <p>@content.Author</p>
                            <time datetime="@content.CreatedOn.ToString("yyyy-MM-dd HH-mm-ss")">@content.CreatedOn.Humanize()</time>
                        </section>
                    </article>
                </div>
            </section>
        }
        else
        {
            <NavLink href="@content.ContentUrl">
                <section class="[ flex ] [ space-x-2 ]">
                    <header class="[ basis-2/5 ]">
                        <figure>
                            <img src="@content.PosterUrl" alt="@content.Title" loading="lazy" />
                        </figure>
                    </header>
                    <div class="[ basis-3/5 ]">
                        <article class="[ flex flex-col ] [ dark:text-white ]">
                            <h2 class="[ font-medium text-sm break-words leading-tight ]">@content.Title</h2>
                            <section class="[ flex flex-col ]">
                                <p class="[ text-xs dark:text-neutral-400 ]">@content.Author</p>
                                <time class="[ text-xs dark:text-neutral-400 ]" datetime="@content.CreatedOn.ToString("yyyy-MM-dd HH-mm-ss")">@content.CreatedOn.Humanize()</time>
                            </section>
                        </article>
                    </div>
                </section>
            </NavLink>
        }
    }
    <GoogleAdSense Type="GoogleAdSenseAdType.InFeed" Format="GoogleAdSenseAdFormat.Fluid" LayoutKey="-7m+de+1z+n+3" Slot="2741354693"></GoogleAdSense>
</aside>

@code {
    [Parameter, EditorRequired] public string Title { get; set; } = default!;
    [CascadingParameter] public bool SmallDevice { get; set; }
}