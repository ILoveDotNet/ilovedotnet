@page "/"
@using Toolbelt.Blazor.HeadElement
@inject IConfiguration configuration

<Meta Property="description" Content="@Description" />
<Meta Property="keywords" Content=".NET, DotNet, I Love DotNet, I ❤️ DotNet, Blazor, Blazor (WebAssembly), Blazor Wasm, C#, Entity Framework Core, LINQ, ML.NET, Web API" />
<Meta Property="url" Content="@BaseUrl" />
<Meta Property="identifier-URL" Content="@BaseUrl" />
<Meta Property="og:site_name" Content="@Title" />
<Meta Property="og:type" Content="website" />
<Meta Property="og:title" Content="@Title" />
<Meta Property="og:description" Content="@Description" />
<Meta Property="og:url" Content="@BaseUrl" />
<Meta Property="twitter:card" Content="summary" />
<Meta Property="twitter:title" Content="@Title" />
<Meta Property="twitter:description" Content="@Description" />
<Meta Property="twitter:url" Content="@BaseUrl" />
<HeadContent>
    <link rel="sitemap" href="@($"{BaseUrl}sitemap.xml")" type="application/xml" title="Sitemap" />
    <link rel="alternate" href="@($"{BaseUrl}atom.xml")" type="application/rss+xml" />
    <link rel="alternate" href="@BaseUrl" hreflang="en" />
    <link rel="alternate" href="@BaseUrl" hreflang="x-default" />
    <link rel="canonical" href="@BaseUrl" />
    <link rel="index" href="@BaseUrl" title="I ❤️ DotNet" />
    @(new MarkupString(
    $@"<script type=""application/ld+json"">
    {{
        ""@context"": ""https://schema.org"",
        ""@type"": ""WebSite"",
        ""publisher"": {{
            ""@type"": ""Organization"",
            ""name"": ""{Title}"",
            ""url"": ""{BaseUrl}"",
            ""logo"": {{
                ""@type"": ""ImageObject"",
                ""url"": ""{BaseUrl}favicon.ico"",
                ""width"": 16,
                ""height"": 16
            }}
        }},
        ""url"": ""{BaseUrl}"",
        ""mainEntityOfPage"": {{
            ""@type"": ""WebPage"",
            ""@id"": ""{BaseUrl}""
        }},
        ""description"": ""{Description}""
    }}
    </script>"))
</HeadContent>

<section class="[ dark:bg-stone-900 ] [ flex flex-col ] [ space-y-5 ] [ p-5 ]">
    <div class="[ max-w-full ]">
        <ul class="[ list-none ] [ flex items-center justify-start ] [ space-x-3 ] [ overflow-hidden overflow-x-auto ]">
            <li class="@($"[ cursor-pointer ] [ px-3 py-1 ] [ rounded-full ] [ {(selectedContentType == null ? activeClass : inActiveClass)} ]")"
                onclick="@(() => FilterContent(null))">All</li>
            @foreach(var contentType in TableOfContents.Contents.Select(content => content.Type).Distinct())
            {
                <li class="@($"[ cursor-pointer ] [ px-3 py-1 ] [ rounded-full ] [ {(selectedContentType is not null && selectedContentType.Equals(contentType, StringComparison.OrdinalIgnoreCase) ? activeClass : inActiveClass)} ]")"
                    @onclick="@(() => FilterContent(@contentType))">@contentType</li>
            }
        </ul>
    </div>
    <div class="[ grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 ]">
        @foreach (var content in Contents)
        {
             <Thumbnail PosterUrl="@content.ThumbnailUrl" 
                    ContentUrl="@content.ContentUrl"
                    Title="@content.Title"
                    AltText="@content.Title"
                    IconUrl="@content.IconUrl"
                    IconAlt="@content.Type"
                    CreatedOn="@content.CreatedOn"
                    Author="@content.Author">
            </Thumbnail>           
        }
    </div>
</section>

@code {
    private string Title = "I ❤️ DotNet";
    private string Description = "This is a .NET knowledge sharing platform with live demos crafted by developers for developers with love.";
    private string BaseUrl => configuration.GetValue<string>("baseUrl");
    private List<ContentMetaData> Contents = new(0);
    private string? selectedContentType = null;
    private string activeClass = "bg-black text-white dark:bg-white dark:text-black";
    private string inActiveClass = "bg-gray-200 text-black dark:bg-gray-600 dark:text-white";

    [Inject] private TableOfContents TableOfContents { get; set; } = default!;

    protected override void OnInitialized()
    {
        FilterContent(null);
    }

    private void FilterContent(string? contentType)
    {
        selectedContentType = contentType;

        if (selectedContentType is null)
        {
            Contents = TableOfContents.Contents.OrderByDescending(content => content.CreatedOn).ToList();
            return;
        }   

        Contents = TableOfContents.Contents
                                  .Where(content => content.Type.Equals(selectedContentType, StringComparison.OrdinalIgnoreCase))
                                  .OrderByDescending(content => content.CreatedOn)
                                  .ToList();
    }
}